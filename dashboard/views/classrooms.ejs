<% include includes/header %>
<div class="wrapper">
	<% include includes/sidebar %>
	<div class="main-panel">
	<% include includes/navbar %>
		<div class="content">
			<div class="container-fluid">
          <% include includes/flash-errors %>
          <div class="row">
              <div class="col-md-12">
                  <div class="card">
                      <form method="get" id="user-form">
                        <div class="col-md-3">
                          <div class="form-group form-black label-floating is-empty">
                              <input data-l10n-id="doe" placeholder="Search Class..." class="form-control" name="classroom" value="<% if(query.q){ %><%= query.q %><% } %>" type="text">
                              <span class="material-input"></span>
                          </div>
                        </div>
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-6">
						  <a class="btn btn-round pull-right " onclick="sess_forget();" href="/dashboard/classrooms/add" data-l10n-id="addClassroom"><div class="ripple-container"></div></a>
                          <button class="btn pull-right btn-round" onclick="sess_forget();" type="submit" data-l10n-id="showResults"><div class="ripple-container"></div></button>
                        </div>
                      
                  </div>
              </div>
              <input type="text" name="sort" id="sort" style="display: none">
              <div class="col-md-12">
                  <% if(data.classrooms.length == 0){%>
                    <div class="text-center" style="margin-top:50px;">
                            <i class="material-icons dp96">info_outline</i>
                            <p data-l10n-id="noClassroomText"></p>
                        </div>
                  <% } else{%>
                    <div class="card">
                        <div class="card-header row" data-background-color="black">
                            <div class="col-md-4 col-sm-4 col-lg-4 text-left">
                            <% if(data.links.prev_page) { %>
                               <a href="<%= data.links.prev_page %>" id="page" data-l10n-id="prevPage"><< Prev page</a>
                            <% } %>
                            </div>
                            <div class="col-md-4 col-sm-4 col-lg-4 text-center" data-l10n-id="showingResults" data-l10n-args='{ "offset": "<%= data.offset + 1 %>", "to": "<%= data.offset + data.classrooms.length %>", "total": "<%= data.total %>" }'></div>
                            <div class="col-md-4 col-sm-4 col-lg-4 text-right">
                            <% if(data.links.next_page) { %>
                               <a href="<%= data.links.next_page %>" id="page" data-l10n-id="nextPage">Next page >></a>

                            <% } %>
                            </div>
                        </div>
                        <div class="card-content table-responsive">
                            <table class="table">
                                <thead class="text-muted">
                                    <tr>
                                        <th>#</th>
                                        <th data-l10n-id="icon">Icon</th>
                                        <th> <button data-l10n-id="name" id="class-name"></button></th>
                                        <th data-l10n-id="studentsCount">Students Count</th>
                                        <th><button data-l10n-id="lastSeen" id="class-last"></button></th>
                                        <th data-l10n-id="action">Action</th>
                                    </tr>
                                </form>
                                </thead>
                                <tbody>
                                    <% for(var i=0; i < data.classrooms.length; i++) { %>
                                      <tr>
                                          <td><%= data.offset + i + 1 %></td>
                                          <td>
                                              <div class="color" id="<%= data.classrooms[i]._id %>">
                                                  <div class="xo-icon"></div>
                                              </div>
                                          </td>
                                          <script>
                                              new icon().load("/public/img/classroom-icon.svg", (<%- JSON.stringify(data.classrooms[i].color) %>), "<%= data.classrooms[i]._id %>");
                                          </script>
                                          <td><%= data.classrooms[i].name %></td>
                                          <td><%= data.classrooms[i].students.length %></td>
                                          <td><%= moment(data.classrooms[i].timestamp).calendar() %></td>
                                          <td>

                                              <% if(Array.isArray(data.classrooms[i].students) && data.classrooms[i].students.length > 0) { %>
                                                  <a data-l10n-id="viewStudents" title="View Students" href="/dashboard/users?role=student&classroom_id=<%- data.classrooms[i]._id %>&classid=<%- data.classrooms[i].students.join(',') %>"><span class="student-icon"></span></a>
                                              <% } else { %>
                                                  <a title="View Students" style="pointer-events: none;"><span class="student-icon" style="opacity: 0.4;"></span></a>
                                              <% } %>
                                              <a data-l10n-id="editClassroom" title="Edit Classroom" href="/dashboard/classrooms/edit/<%= data.classrooms[i]._id %>"><i class="material-icons text-muted">edit</i></a>
                                              <a data-l10n-id="deleteClassroom" title="Delete Classroom" href="/dashboard/classrooms/delete/<%= data.classrooms[i]._id %>?&name=<%= data.classrooms[i].name %>" onclick="return confirm(document.webL10n.get('DoYouWantDeleteClassroom', {classroom:'<%= data.classrooms[i].name %>'}))"><i class="material-icons text-muted">delete_forever</i></a>
                                          </td>
                                      </tr>
                                    <% } %>
                                </tbody>
                            </table>
                        </div>
                    </div>
                <%}%>
              </div>
          </div>
			</div>
		</div>
	</div>
</div>
<% include includes/footer %>
<script>
    document.getElementById("class-name").addEventListener("click",function(){
        sessionStorage.removeItem("class-last-count");
        if(sessionStorage.getItem("class-name-count")!=null){
            var user_name_count = sessionStorage.getItem("class-name-count");
            user_name_count++;
            if(user_name_count==1){
                document.getElementById("sort").setAttribute("value","");
                sessionStorage.setItem("class-name-count",1);
                sessionStorage.setItem("cur","class-name-none");
            }
            else if(user_name_count==2){
                document.getElementById("sort").setAttribute("value","+name");
                sessionStorage.setItem("class-name-count",2);
                sessionStorage.setItem("cur","class-name-up");
            } else if(user_name_count==3){
                document.getElementById("sort").setAttribute("value","-name");
                sessionStorage.setItem("class-name-count",0);
                sessionStorage.setItem("cur","class-name-down");
            }
        } else{
            sessionStorage.setItem("class-name-count",2);
            document.getElementById("sort").setAttribute("value","+name");
            sessionStorage.setItem("cur","class-name-up");
        }
        

    });
    document.getElementById("class-last").addEventListener("click",function(){
        sessionStorage.removeItem("class-name-count");
        if(sessionStorage.getItem("class-last-count")!=null){
            var user_name_count = sessionStorage.getItem("class-last-count");
            user_name_count++;
            if(user_name_count==1){
                document.getElementById("sort").setAttribute("value","");
                sessionStorage.setItem("class-last-count",1);
                sessionStorage.setItem("cur","class-last-none");
            }
            else if(user_name_count==2){
                document.getElementById("sort").setAttribute("value","+timestamp");
                sessionStorage.setItem("class-last-count",2);
                sessionStorage.setItem("cur","class-last-up");
            } else if(user_name_count==3){
                document.getElementById("sort").setAttribute("value","-timestamp");
                sessionStorage.setItem("class-last-count",0);
                sessionStorage.setItem("cur","class-last-down");
            }
        } else{
            sessionStorage.setItem("class-last-count",2);
            document.getElementById("sort").setAttribute("value","+timestamp");
            sessionStorage.setItem("cur","class-last-up");
        }

    });

    var page = document.getElementById("page");
    if(page!=null){
        document.getElementById("page").addEventListener("click",function(){
            if((sessionStorage.getItem("rem")!=null)&&(sessionStorage.getItem("cur")==null)){
                var rem = sessionStorage.getItem("rem");
                sessionStorage.setItem("cur",rem);
            }
        });
    }

    if(sessionStorage.getItem("cur")!=null){
        var cur = sessionStorage.getItem("cur");
        console.log(cur);
        sessionStorage.setItem("rem",cur);
        if(cur=="class-name-up"){
            document.getElementById("class-name").innerHTML = document.getElementById("class-name").innerHTML + '<i class="arrow up"></i>' ; 
        } else if(cur=="class-name-down"){
            document.getElementById("class-name").innerHTML = document.getElementById("class-name").innerHTML + '<i class="arrow down"></i>' ;
        } else if(cur=="class-last-up"){
            document.getElementById("class-last").innerHTML = document.getElementById("class-last").innerHTML + '<i class="arrow up"></i>' ;
        } else if(cur=="class-last-down"){
            document.getElementById("class-last").innerHTML = document.getElementById("class-last").innerHTML + '<i class="arrow down"></i>' ;
        }
        sessionStorage.removeItem("cur");
    }

</script>

